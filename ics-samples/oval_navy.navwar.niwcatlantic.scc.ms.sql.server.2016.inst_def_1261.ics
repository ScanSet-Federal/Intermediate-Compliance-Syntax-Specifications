DEF
VAR var_1 string `sqlserver`
VAR var_2 string `2016|2017|2019|2022`
CRI AND
CTN sqlext
    TEST `any exist` `at least one`
    STATE ste_1101
        result string equals `
    `
    STATE_END
    OBJECT obj_1101
        engine VAR var_1
        version VAR var_2
        instance `.*`
        database ``
        sql `SELECT name AS 'audit_name',
				status_desc AS 'audit_status',
				audit_file_path AS 'current_audit_file'
				FROM sys.dm_server_audit_status`
        behavior context instance
    OBJECT_END
CTN_END
CTN sqlext
    TEST `none exist` all
    OBJECT obj_1261
        engine VAR var_1
        version VAR var_2
        instance `.*`
        database ``
        sql `select 'DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP' as audit_action_name
union select 'DATABASE_OBJECT_PERMISSION_CHANGE_GROUP'
union select 'DATABASE_OWNERSHIP_CHANGE_GROUP'
union select 'DATABASE_PERMISSION_CHANGE_GROUP'
union select 'DATABASE_ROLE_MEMBER_CHANGE_GROUP'
union select 'SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP'
union select 'SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP'
union select 'SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP'
union select 'SERVER_OBJECT_PERMISSION_CHANGE_GROUP'
union select 'SERVER_PERMISSION_CHANGE_GROUP'
union select 'SERVER_ROLE_MEMBER_CHANGE_GROUP'
except
	SELECT d.audit_action_name AS 'ActionName'
	FROM sys.server_audit_specifications s
	JOIN sys.server_audits a ON s.audit_guid = a.audit_guid
	JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id
	WHERE a.is_state_enabled = 1
	and s.is_state_enabled = 1
						`
        behavior context instance
    OBJECT_END
CTN_END
CRI_END
DEF_END