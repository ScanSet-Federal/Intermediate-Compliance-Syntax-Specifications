DEF
VAR var_1 string `sqlserver`
VAR var_2 string `2016|2017|2019|2022`
CRI OR
CRI AND
CTN sqlext
    TEST `any exist` all
    STATE ste_601
        result string equals `
    `
    STATE_END
    OBJECT obj_21
        engine VAR var_1
        version VAR var_2
        instance `.*`
        database ``
        sql `SELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly')    
		WHEN 1 THEN 'Windows Authentication'    
		WHEN 0 THEN 'Windows and SQL Server Authentication'    
		END as [authentication_mode]`
        behavior context instance
    OBJECT_END
CTN_END
CTN sqlext
    TEST `any exist` all
    STATE ste_603
        result string equals `
    `
    STATE_END
    OBJECT obj_603
        engine VAR var_1
        version VAR var_2
        instance `.*`
        database ``
        sql `SELECT [name], is_expiration_checked, is_policy_checked
FROM sys.sql_logins
where name not in ('sa', '##MS_PolicyTsqlExecutionLogin##', '##MS_PolicyEventProcessingLogin##')
AND principal_id !=1`
        behavior context instance
    OBJECT_END
CTN_END
CTN passwordpolicy
    TEST `at least one exists` all
    STATE ste_604
        max_passwd_age int `less than or equal` `5184000`
        min_passwd_age int `greater than or equal` `86400`
        min_passwd_len int `greater than or equal` `14`
        password_hist_len int `greater than or equal` `24`
        password_complexity boolean equals `1`
        reversible_encryption boolean equals `0`
        anonymous_name_lookup boolean equals `0`
    STATE_END
    STATE ste_605
        max_passwd_age int `greater than` `0`
    STATE_END
    OBJECT obj_604
        # Empty object - no fields required for this test type
    OBJECT_END
CTN_END
CRI_END
CRI AND
CTN sqlext
    TEST `any exist` all
    STATE ste_21
        result string equals `
    `
    STATE_END
    OBJECT obj_21
        engine VAR var_1
        version VAR var_2
        instance `.*`
        database ``
        sql `SELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly')    
		WHEN 1 THEN 'Windows Authentication'    
		WHEN 0 THEN 'Windows and SQL Server Authentication'    
		END as [authentication_mode]`
        behavior context instance
    OBJECT_END
CTN_END
CTN passwordpolicy
    TEST `at least one exists` all
    STATE ste_604
        max_passwd_age int `less than or equal` `5184000`
        min_passwd_age int `greater than or equal` `86400`
        min_passwd_len int `greater than or equal` `14`
        password_hist_len int `greater than or equal` `24`
        password_complexity boolean equals `1`
        reversible_encryption boolean equals `0`
        anonymous_name_lookup boolean equals `0`
    STATE_END
    STATE ste_605
        max_passwd_age int `greater than` `0`
    STATE_END
    OBJECT obj_604
        # Empty object - no fields required for this test type
    OBJECT_END
CTN_END
CRI_END
CRI_END
DEF_END